#!/bin/bash
python speech_to_text_ctc_bpe_ts.py \
--config-path=../conf/conformer \
--config-name=conformer_ctc_bpe_ts_conformer.yaml \
model.tokenizer.type=bpe \
model.tokenizer.dir=/home/yangzhang/code/ts_asr/ckpts/stt_en_conformer_ctc_medium_1.0.0/tokenizer_spe_unigram_v128/ \
model.train_ds.manifest_filepath=/mnt/data/LibriSpeech/train_clean_100_360.json \
trainer.max_epochs=50 \
model.num_sources=5 \
model.validation_ds.num_sources=1 \
model.test_ds.num_sources=1 \
model.validation_ds.manifest_filepath=/mnt/data/libricss/dev_utterances.json \
model.train_ds.max_duration=11 \
model.train_ds.mixing_portion=[0.2,0.2,0.2,0.2,0.2] \
model.tokenizer.type=bpe \
trainer.num_sanity_val_steps=10 \
model.test_ds.manifest_filepath=/mnt/data/libricss/test_utterances.json  \
model.speaker_embeddings.freeze_decoder=False \
model.speaker_embeddings.freeze_encoder=True \
model.freeze_asr_decoder=False \
model.freeze_asr_encoder=False \
model.train_ds.batch_size=8 \
model.train_ds.synthetic_generation=True \
model.train_ds.num_workers=8 \
model.validation_ds.num_workers=8 \
model.validation_ds.batch_size=8 \
model.validation_ds.synthetic_generation=False \
model.train_ds.augmentor.impulse.manifest_path=/mnt/data/rir_noises/rir_noises/rir_reverb_manifest.json \
model.train_ds.augmentor.noise.manifest_path=/mnt/data/rir_noises/rir_noises/rir_noise_manifest.json \
model.train_ds.augmentor.noise.prob=0.3 \
model.train_ds.augmentor.impulse.prob=0.3 \
+model.train_ds.dynamic_scaling=true \
+model.train_ds.volume_perturb=true \
model.test_ds.num_workers=4 \
model.test_ds.batch_size=4 \
model.test_ds.synthetic_generation=False \
model.test_ds.sample_rate=16000 \
trainer.devices=[0] \
trainer.log_every_n_steps=50 \
model.encoder.d_model=256 \
model.encoder.n_heads=4 \
model.encoder.n_layers=18 \
model.speaker_beam.n_layers=18 \
dataset="librispeech" \
trainer.val_check_interval=1.0 \
model.optim.lr=2 \
+nemo_checkpoint_path=/home/yangzhang/code/ts_asr/ckpts/stt_en_conformer_ctc_medium_1.0.0/stt_en_conformer_ctc_medium.nemo